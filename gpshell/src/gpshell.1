.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "GPSHELL" "1" "" "1.4.5" "GPShell Documentation"
.hy
.SH NAME
.PP
\f[B]gpshell\f[R] - command line tool for the management of
GlobalPlatform compliant smart cards
.SH SYNOPSIS
.PP
\f[B]gpshell\f[R] \f[I]scriptfile\f[R]
.SH DESCRIPTION
.PP
gpshell can manage applications on smart cards supporting the
GlobalPlatform.
This comprises the installation and deletion of applications, getting
the applications status and card data.
These applications are practical always Java Card applets.
Additional key management commands are provided.
.PP
The most common way to use gpshell is a script file.
But it is also possible to read the commands from stdin if no script
file is provided.
.SH COMMANDS
.TP
-mode_201
Set protocol mode to OpenPlatform 2.0.1.
This is the default.
.TP
-mode_211
Set protocol mode to GlobalPlatform 2.1.1 and later
.TP
-visa_key_derivation
For cards which use the VISA key derivation scheme for the key
calculation, like GemXpresso Pro, Palmera Protect or some JCOP cards
this must be set.
.TP
-emv_cps11_key_derivation
For cards which uses the EMV CPS 1.1 key derivation scheme for the key
calculation, like a Sm\[at]rtCafe Expert 3.0 this must be set.
.TP
-enable_trace
Enable APDU trace
.PP
You will see the sent APDUs in clear text.
The last two bytes of the response are the response code.
A response code of 9000 means success, otherwise the response code
indicates an error.
This may be OK when deleting a non existing applet or package.
.TP
-enable_timer
Enable the logging of the execution times of commands.
.TP
-establish_context
Establish context.
This must always be executed before connecting to a card.
.TP
-card_connect -reader \f[I]readerName\f[R]
Connect to card in the reader with \f[I]readerName\f[R]
.TP
-card_connect -readerNumber \f[I]x\f[R]
Connect to card in the \f[I]x\f[R] th reader in the system
.TP
-open_sc -keyind \f[I]x\f[R] -keyver \f[I]x\f[R] -key \f[I]key\f[R] -mac_key \f[I]mac-key\f[R] -enc_key \f[I]enc-key\f[R] -kek_key \f[I]kek-key\f[R] -security \f[I]securityLevel\f[R] -scp \f[I]protocol\f[R] -scpimpl \f[I]impl\f[R] -keyDerivation \f[I]derivation\f[R]
Open a secure channel
.PP
For OpenPlatform 2.0.1\[cq] cards only -keyind -keyver -mac_key and
-enc_key are necessary.
.PP
For GlobalPlatform 2.1.1 and later cards -scp and -scpimpl should not be
necessary to supply.
You must also specify -kek_key.
.PP
If the card supports a Secure Channel Protocol Implementation with only
one base key, specify this key with -key and omit the others.
.PP
If the card uses a key derivation mechanism you must enable the
derivation mode with the -keyDerivation option and you must specify with
-key the master (mother) key.
-kek_key, -mac_key and -enc_key are not relevant is this case.
See the section Options and Key Derivation.
.TP
-select -AID \f[I]AID\f[R]
Select AID instance
.TP
-install -file \f[I]appletFile\f[R] -priv \f[I]privilege\f[R] -sdAID \f[I]sdAID\f[R] -AID \f[I]AIDInPkg\f[R] -pkgAID \f[I]packageAID\f[R] -instAID \f[I]instanceAID\f[R] -nvCodeLimit \f[I]x\f[R] -nvDataLimit \f[I]y\f[R]
Load and installs in one step
.PP
The parameters -AID -instAID -pkgAID -nvCodeLimit can be detected
automatically and the -AID and -instAID is set to the first applet in
\f[I]appletfile\f[R].
.PP
For the \f[I]sdAID\f[R] the AID selected with the select command is
chosen if not given.
Otherwise the default Card Manager / Security Issuer Domain AID is
chosen.
Usually you do not have to pass it.
.TP
-install_for_load -pkgAID \f[I]packageAID\f[R] -sdAID \f[I]sdAID\f[R] -nvCodeLimit \f[I]y\f[R]
Install for Load
.PP
For the \f[I]sdAID\f[R] the AID selected with the select command is
chosen if not given.
Otherwise the default Card Manager / Security Issuer Domain AID is
chosen.
Usually you do not have to pass it.
.PP
This command may be needed if the combined install command does not
work.
.TP
-load -file \f[I]appletFile\f[R]
Load applet
.PP
This command may be needed if the combined install command does not
work.
.TP
-install_for_install -priv \f[I]privilege\f[R] -AID \f[I]AIDInPkg\f[R] -pkgAID \f[I]pkgAID\f[R] -instAID \f[I]instanceAID\f[R] -nvDataLimit \f[I]x\f[R]
Instantiate applet
.PP
This command may be needed if the combined install command does not
work.
Or you want to install a pre-installed Security Domain.
.TP
-card_disconnect
Disconnect card
.TP
-get_status -element \f[I]e0\f[R]
List applets and packages and security domains
.TP
-get_status -element \f[I]20\f[R]
List packages
.TP
-get_status -element \f[I]40\f[R]
List applets or security domains
.TP
-get_status -element \f[I]80\f[R]
List Card Manager / Security Issuer Domain
.TP
-release_context
Release context
.TP
-put_sc_key -keyver \f[I]keyver\f[R] -newkeyver \f[I]newkeyver\f[R] -mac_key \f[I]new_MAC_key\f[R] -enc_key \f[I]new_ENC_key\f[R] -kek_key \f[I]new_KEK_key\f[R]
Add or replace a key set version
.PP
If a new key set version is to be added \f[I]keyver\f[R] must be set to
0.
If \f[I]keyver\f[R] equals \f[I]newkeyver\f[R] an existing key version
is replaced.
.TP
-put_sc_key -keyver \f[I]keyver\f[R] -newkeyver \f[I]newkeyver\f[R] -key \f[I]key\f[R] -keyDerivation \[lq]derivation\[rq]
Replace key set version \f[I]keyver\f[R] using key derivation
\f[I]derivation\f[R] using the master (mother) key \f[I]y\f[R]
.TP
-put_dm_keys -keyver \f[I]keyver\f[R] -newkeyver \f[I]newkeyver\f[R] -file \f[I]public_rsa_key_file\f[R] -pass \f[I]password\f[R] -key \f[I]new_receipt_generation_key\f[R]
Add a RSA delegated management key in version \f[I]newkeyver\f[R]
.TP
-send_apdu -sc 0 -APDU \f[I]apdu\f[R]
Send APDU \f[I]apdu\f[R] without secure channel
.PP
The APDU is given as hex without spaces and without leadings 0x.
.TP
-send_apdu_nostop -sc 0 -APDU \f[I]apdu\f[R]
Does not stop in case of an error
.PP
The APDU is given as hex without spaces and without leadings 0x.
.TP
-get_data -identifier \f[I]identifier\f[R]
A GET DATA command returning the data for the given identifier.
See the identifier options for details.
.TP
-get_key_information_templates -keyTemplate \f[I]index\f[R]
A GET DATA command returning the key information templates in the
selected security domain.
.TP
-get_extended_card_resources_information
A GET DATA command returning the extended card resources information in
the issuer security domain.
.SH OPTIONS
.TP
\[en]keyind \f[I]x\f[R]
Key index \f[I]x\f[R]
.PP
\[en]keyver \f[I]x\f[R] Key set version x
.TP
\[en]newkeyver \f[I]x\f[R]
New key set version x
.TP
\[en]key \f[I]key\f[R]
Key value in hex
.TP
\[en]mac_key \f[I]key\f[R]
MAC key value in hex
.TP
\[en]enc_key \f[I]key\f[R]
ENC key value in hex
.TP
\[en]kek_key \f[I]key\f[R]
KEK key value in hex
.TP
\[en]security \f[I]x\f[R]
0: clear, 1: MAC, 3: MAC+ENC, 51: MAC+ENC+R-MAC+E-ENC (SCP03 only), 19:
MAC+ENC-R-MAC (SCP02+SCP03 only), 17: MAC+R-MAC (SCP02+SCP03 only)
.TP
\[en]reader \f[I]readerName\f[R]
Smart card reader name
.TP
\[en]readerNumber \f[I]x\f[R]
Number of the reader in the system to connect to.
If -reader is given this is ignored.
.TP
\[en]protocol \f[I]x\f[R]
Protocol, 0:T=0, 1:T=1 Should not be necessary to be stated explicitly.
.TP
\[en]AID \f[I]aid\f[R]
Applet ID
.TP
\[en]sdAID \f[I]aid\f[R]
Security Domain AID
.TP
\[en]pkgAID \f[I]aid\f[R]
Package AID
.TP
\[en]instAID \f[I]aid\f[R]
Instance AID
.TP
\[en]nvCodeLimit \f[I]x\f[R]
Non-volatile code size limit
.TP
\[en]nvDataLimit \f[I]x\f[R]
Non-volatile data size limit
.TP
\[en]vDataLimit \f[I]x\f[R]
Volatile data size limit
.TP
\[en]file \f[I]name\f[R]
File name
.TP
\[en]instParam \f[I]param\f[R]
Installation parameter
.TP
\[en]element \f[I]x\f[R]
Element type to be listed in hex
.IP \[bu] 2
80 - Card Manager / Card Issuer Security Domain only.
.IP \[bu] 2
40 - Applications (and Security Domains only in GP211 and later).
.IP \[bu] 2
20 - Executable Load Files only.
.IP \[bu] 2
10 - Executable Load Files and their Executable Modules only (Only GP211
and later)
.TP
\[en]format \f[I]x\f[R]
Sets the format of the response of the get_status command.
This is only used for GlobalPlatform cards and required and only needed
if the default is not supported by the smart card.
.TP
\[en]keyTemplate \f[I]x\f[R]
Sets the key template index to return for the get_key_templates command.
Default 0.
.IP \[bu] 2
0 - Deprecated format
.IP \[bu] 2
2 - New format (default)
.TP
\[en]sc \f[I]x\f[R]
Secure Channel mode (0 off, 1 on)
.TP
\[en]APDU \f[I]apdu\f[R]
APDU to be sent.
Must be in hex format, e.g.\ 80CA00CF00.
.TP
\[en]priv \f[I]x\f[R]
Privilege.
E.g.
0x04 Default Selected
.TP
\[en]scp \f[I]x\f[R]
Secure Channel Protocol (1 SCP01, 2 SCP02, 3 SCP03, default no set).
Should not be necessary to be stated explicitly.
.TP
\[en]scpimpl \f[I]x\f[R]
Secure Channel Implementation (default not set) Should not be necessary
to be stated explicitly.
.TP
\[en]pass \f[I]password\f[R]
Password for key decryption
.TP
\[en]identifier \f[I]identifier\f[R]
Identifier for the tag for the get_data command.
Must be in hex format, e.g.\ 9F7F.
.PP
There are several identifiers available but in general not all cards are
supporting them.
The GlobalPlatform specification v2.3.1 lists a few in section 11.3.3.1.
It is useful to use some ASN.1 parser to interpret these data, like
asn1js (https://lapo.it/asn1js)
.PP
Some useful identifier are:
.IP \[bu] 2
9F7F - CPLC (Card Production Life Cycle) Data
.IP \[bu] 2
00E0 - Key Information Templates.
Instead of the first byte 00 also 01, \&... can be used to get more key
information templates if available.
There is a dedicated command for getting this:
get_key_information_templates
.IP \[bu] 2
2F00 - List of applications
.IP \[bu] 2
FF21 - Extended card resources.
There is a dedicated command for getting this:
get_extended_card_resources_information
.TP
\[en]keyDerivation \f[I]derivation method\f[R]
Possible values are \f[I]none\f[R], \f[I]visa2\f[R] or
\f[I]emvcps11\f[R]
.PP
Choose \f[I]visa2\f[R] if you have a card which uses the VISA key
derivation scheme for the key calculation, like GemXpresso Pro or some
JCOP cards you must set this.
.PP
Choose \f[I]emvcps11\f[R] If you have a card which uses the EMV CPS 1.1
key derivation scheme for the key calculation, like a Sm\[at]rtCafe
Expert 3.0 and later you must set this.
Also for put_sc_key this is necessary for Sm\[at]rtcafe 5.0 (and
earlier(?)) cards
.SH ENVIRONMENT
.TP
-GLOBALPLATFORM_DEBUG
Enables debugging output from the underlying GlobalPlatform library.
.TP
-GLOBALPLATFORM_LOGFILE
Sets the log file name for the debugging output.
.SH Key Derivation
.TP
-visa2
For the VISA2 key derivation scheme, like used in a GemXpresso Pro or
some JCOP cards.
.TP
-emvcps11
For the key derivation according to EMV CPS 1.1 (CDK (CPG 2.04)), like
Sm\[at]rtCafe Expert 3.0 and later.
.PP
Known unsupported key derivation schemes are:
.IP \[bu] 2
CDK (CPG 2.02)
.IP \[bu] 2
ISK(D)
.SH BUGS
.TP
JCOP 10
install_for_load fails for unknown reason, so nothing can be installed.
.SH AUTHOR
.PP
Karsten Ohme \f[I]k_o_\[at]users.sourceforge.net\f[R] Snit Mo
\f[I]snitmo\[at]gmail.com\f[R]
.PP
See the file \f[C]AUTHORS\f[R] for a complete list.
